# VO2max Report — Универсальная система анализа функциональной диагностики спортсменов

## 🎯 Суть проекта

**VO2max Report** — это программное обеспечение для комплексного анализа данных функциональной диагностики спортсменов. Система предназначена для объединения результатов тестирований с различного оборудования (газоанализаторы, вентилометры, пульсометры, лактатометры, эргометры) в единую базу данных и автоматической генерации профессиональных отчётов.

---

## 💡 Зачем это нужно?

### Проблема

При проведении функционального тестирования спортсменов специалисты сталкиваются с несколькими критическими проблемами:

1. **Разнородность оборудования**: Каждый производитель использует свой формат данных
   - **PNOE**: CSV с полями `VO2(ml/min)`, `VCO2(ml/min)`, `RER`, `VE(l/min)` и др.
   - **Ergospirometry devices**: CSV с форматом `VO2[mL/kg/min]`, `VO2[mL/min]`, `HR[bpm]` и др.
   - **Custom JSON**: Вложенные структуры с `Flow`, `O2_Flow`, `CO2_Flow`, `Power`, `Cadence`, `SD1`, `SD2`
   - **PC2 файлы**: Проприетарные форматы от различных производителей

2. **Ручная обработка данных**: Сведение результатов 10+ тестов одного спортсмена вручную занимает часы и чревато ошибками

3. **Сравнительный анализ**: Отслеживание динамики показателей во времени требует постоянного пересчёта и переформатирования

4. **Генерация отчётов**: Создание документов со всеми графиками, таблицами и маркерами занимает огромное количество времени

### Решение

**VO2max Report** решает эти проблемы:

- ✅ **Единый формат хранения** — все данные приводятся к унифицированной модели независимо от источника
- ✅ **Автоматический парсинг** — импорт CSV/JSON файлов с автоматическим распознаванием полей
- ✅ **База данных спортсменов** — централизованное хранение профилей и истории тестирований
- ✅ **Динамический анализ** — отслеживание прогресса по мощности, пульсу, VO2, вентиляции, лактату
- ✅ **Генерация DOCX отчётов** — профессиональные документы с графиками и маркерами за один клик

---

## 📊 Какие данные обрабатывает система?

### Основные измеряемые параметры

| Параметр | Описание | Единицы измерения |
|----------|----------|-------------------|
| **VO2** | Потребление кислорода | мл/мин, мл/кг/мин |
| **VCO2** | Выделение углекислого газа | мл/мин |
| **Ve** | Лёгочная вентиляция | л/мин |
| **Tv** | Дыхательный объём | л |
| **Rf** | Частота дыхания | уд/мин |
| **HR** | Частота сердечных сокращений | уд/мин |
| **Power** | Мощность нагрузки | Вт |
| **RPM/Cadence** | Каденс (частота педалирования) | об/мин |
| **Lactat** | Концентрация лактата в крови | ммоль/л |
| **RER** | Дыхательный коэффициент (VCO2/VO2) | — |
| **VeVO2** | Вентиляторный эквивалент по кислороду | — |
| **FeO2** | Концентрация кислорода в выдохе | % |
| **HRvar** | Вариабельность сердечного ритма | мс |
| **SD1/SD2** | Показатели вариабельности (Poincaré) | мс |

### Ключевые пороговые показатели

Система определяет и маркирует важнейшие физиологические пороги:

| Показатель | Расшифровка | Значение |
|------------|-------------|----------|
| **МАМ** | Максимальная аэробная мощность | Пиковая мощность на VO2max |
| **АэП** | Аэробный порог (LT1) | Первый лактатный/вентиляторный порог |
| **АнП** | Анаэробный порог (LT2/MLSS) | Критическая интенсивность |
| **ДО2** | Максимальное потребление O2 | VO2max в абсолютных значениях |

---

## 🏗 Текущая архитектура (C# / WPF)

### Технологический стек

- **Язык**: C# (.NET Framework)
- **UI Framework**: WPF (Windows Presentation Foundation)
- **Архитектура**: MVVM (Model-View-ViewModel)
- **ORM**: Entity Framework
- **Генерация документов**: Xceed DocX
- **CSV парсинг**: CsvHelper
- **Диаграммы**: System.Windows.Controls.DataVisualization

### Структура проекта

```
src/
├── Fitness.UI/                  # Основной проект
│   ├── Core/                    # Бизнес-логика
│   │   ├── ReportGenerator.cs   # Генерация DOCX отчётов
│   │   ├── IClientRepository.cs # Репозиторий клиентов
│   │   ├── IMeasurementRepository.cs # Репозиторий измерений
│   │   └── IChartInteraction.cs # Интерфейс работы с графиками
│   ├── Db/                      # Модели данных
│   │   ├── Client.cs            # Профиль спортсмена
│   │   ├── Measurement.cs       # Тестирование
│   │   ├── MeasurementItem.cs   # Единичное измерение
│   │   ├── SportParameter.cs    # Enum порогов (МАМ, АэП, АнП, ДО2)
│   │   └── ClientContext.cs     # EF DbContext
│   ├── View/                    # XAML представления
│   │   ├── ReportView.xaml      # Экран отчётов
│   │   ├── UserView.xaml        # Карточка спортсмена
│   │   └── UsersView.xaml       # Список спортсменов
│   └── ViewModel/               # ViewModels
│       ├── ReportViewModel.cs   # Логика работы с отчётами
│       ├── UserViewModel.cs     # Логика спортсмена
│       └── UsersViewModel.cs    # Логика списка
├── Xceed.Document.NET/          # Библиотека для DOCX
├── Xceed.Words.NET/             # Высокоуровневый API для Word
└── lib/                         # Сторонние зависимости
```

### Модель данных

```
┌─────────────────────────────────────────────────────────────────┐
│                          Client                                  │
├─────────────────────────────────────────────────────────────────┤
│ Id, Name, LastName, SecondName                                   │
│ Gender, Birthdate, Height, Weight                                │
│ ContactInfo                                                      │
│ Measurements (1:N) ─────────────────┐                            │
└─────────────────────────────────────┼────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Measurement                               │
├─────────────────────────────────────────────────────────────────┤
│ Id, MeasurementDate, StartPower, PowerStep, UseInReport          │
│ ClientId (FK)                                                    │
│ MeasurementItems (1:N) ─────────────┐                            │
└─────────────────────────────────────┼────────────────────────────┘
                                      │
                                      ▼
┌─────────────────────────────────────────────────────────────────┐
│                      MeasurementItem                             │
├─────────────────────────────────────────────────────────────────┤
│ Id, TimeSec, Time                                                │
│ VO2mLKgMin, VO2mLMin, HR, Power, RatedPower                      │
│ Rf, Tv, Ve, RPM, VeVO2, FeO2, Temp, HUM                          │
│ Lactat, SportParameter (МАМ/АэП/АнП/ДО2)                         │
│ UseInReport, MeasurementId (FK)                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📄 Поддерживаемые форматы файлов

### 1. Стандартный CSV (Ergospirometry)

```csv
Time[s],Time[hh:mm:ss],VO2[mL/kg/min],VO2[mL/min],HR[bpm],Power[watts],Rf[bpm],Tv[L],Ve[L/min],RPM[rpm],Ve/VO2,FeO2[%],Temp[C],HUM[%RH]
30,00,00:00:30,22.53,1599.14,113.30,103.83,19.84,1.82,36.19,90.96,23.58,15.66,22.64,44.84
```

### 2. PNOE CSV

```csv
T(sec);PHASE;HR(bpm);VO2(ml/min);VCO2(ml/min);RER;VE(l/min);FEO2;FECO2;...
0;;144.83;2517.60;2277.98;0.90;82.35;0.1746;0.0319;...
```

### 3. JSON формат (газоанализаторы с HRV)

```json
{
  "dataMap": [
    [5, {"Flow": 25660, "CO2_Flow": 1339, "O2_Flow": 1462, "R": 0.91, "HR": 110, "SD1": 5.621, "Power": 59, "Cadence": 83}],
    ...
  ],
  "setup": {"name": "Фамилия Имя", "age": 31, "sex": "f", "height": 170, "weight": 53}
}
```

### 4. PC2 (Проприетарные форматы)

Бинарные файлы от различных производителей — требуют индивидуальных парсеров.

---

## 📝 Генерация отчётов

Система генерирует профессиональные отчёты в формате DOCX:

### Содержание отчёта

1. **Данные спортсмена**: ФИО, дата тестирования, вес, начальная мощность, каденс
2. **Таблица измерений**: Время, мощность, ЧСС, лактат, VO2, Ve, Tv, Rf
3. **Сравнительные графики**:
   - Динамика ЧСС по мощности (несколько тестов)
   - Динамика вентиляции (Ve)
   - Динамика потребления O2
   - Динамика лактата (столбчатая диаграмма)
4. **Визуализация порогов**: Маркеры МАМ, АэП, АнП, ДО2 на шкале мощности

### Пример визуализации порогов

```
Мощность, Вт
          200    300    400    500    600    700    800    900   1000
           ├──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┤
МАМ                                                             ▼ (850 Вт)
АэП             ▼ (250 Вт)
АнП                           ▼ (380 Вт)
ДО2                                         ▼ (550 Вт)
```

---

## 🎯 Целевая аудитория

- **Спортивные врачи** — проводящие функциональную диагностику
- **Тренеры** — использующие данные тестирований для планирования нагрузок
- **Научные сотрудники** — исследующие физиологию нагрузки
- **Федерации и спортивные центры** — нуждающиеся в стандартизации отчётности

---

## 🚀 Планы развития

Проект запланирован к рефакторингу с переносом на современный стек:

### Целевой технологический стек

| Компонент | Технология |
|-----------|-----------|
| **Backend** | Python + Django |
| **Database** | PostgreSQL |
| **Frontend** | Django Templates / React |
| **Контейнеризация** | Docker + Docker Compose |
| **API** | Django REST Framework |

### Преимущества миграции

1. **Кроссплатформенность** — работа на любой ОС (Linux, macOS, Windows)
2. **Веб-доступ** — работа через браузер, мобильные устройства
3. **Масштабируемость** — лёгкое добавление новых форматов через плагины
4. **Совместная работа** — многопользовательский режим
5. **API интеграции** — экспорт данных в другие системы (Garmin Connect, TrainingPeaks)
6. **Облачное развёртывание** — возможность хостинга как SaaS

### Ожидаемая структура нового проекта

```
vo2max_report/
├── docker-compose.yml           # Оркестрация контейнеров
├── Dockerfile                   # Образ приложения
├── requirements.txt             # Python зависимости
├── manage.py                    # Django CLI
├── vo2max/                      # Основной Django проект
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── core/                        # Основное приложение
│   ├── models.py                # Client, Measurement, MeasurementItem
│   ├── views.py                 # Django Views / DRF ViewSets
│   ├── serializers.py           # Сериализаторы API
│   ├── admin.py                 # Админ-панель
│   └── parsers/                 # Парсеры форматов
│       ├── base.py              # Базовый класс парсера
│       ├── ergospiro_csv.py     # Ergospirometry CSV
│       ├── pnoe_csv.py          # PNOE CSV
│       ├── json_gas.py          # JSON газоанализаторы
│       └── pc2.py               # PC2 бинарные файлы
├── reports/                     # Модуль генерации отчётов
│   ├── generators/
│   │   ├── docx_generator.py    # DOCX через python-docx
│   │   ├── pdf_generator.py     # PDF через WeasyPrint/ReportLab
│   │   └── html_generator.py    # HTML отчёты
│   └── templates/               # Шаблоны отчётов
├── templates/                   # HTML шаблоны Django
├── static/                      # CSS, JS
└── tests/                       # Тесты
```

---

## 📦 Документация оригинального проекта

В папке `doc/` находятся:

- **ТЗ Тренировочные зоны и модульность отчета.docx** — детальное техническое задание
- **ТЗ 2 Уровень стресса.docx** — спецификация модуля стресса
- **отчет.docx** — пример сгенерированного отчёта
- **исходные.csv** — пример входных данных
- **девайсы/** — примеры файлов с различных устройств:
  - `*.csv` — CSV от PNOE и других систем
  - `*.json` — JSON от газоанализаторов
  - `*.pc2` — Проприетарные форматы

---

## 💪 Итог

**VO2max Report** — это специализированное решение для автоматизации функциональной диагностики в спорте. Система объединяет данные с разнородного оборудования, хранит историю тестирований спортсменов и генерирует профессиональные отчёты, экономя специалистам часы ручной работы при каждом тестировании.

Планируемая миграция на Python/Django обеспечит:
- Работу через веб-интерфейс
- Поддержку мобильных устройств
- Лёгкое добавление новых форматов данных
- Возможность облачного развёртывания
- Интеграцию с внешними сервисами

---

## 📞 Контакты

*[Добавьте контактную информацию по необходимости]*

---

*Документ создан: 28 декабря 2024*
