# Руководство по адаптации VO2max Report

Подробное руководство по модификации проекта под ваши задачи с использованием AI-ассистентов (Antigravity IDE, Cursor, GitHub Copilot, ChatGPT и др.).

---

## Содержание

1. [Подготовка](#1-подготовка)
2. [Описание ваших требований](#2-описание-ваших-требований)
3. [Добавление нового формата данных](#3-добавление-нового-формата-данных)
4. [Создание нового шаблона отчёта](#4-создание-нового-шаблона-отчёта)
5. [Модификация сравнения тестов](#5-модификация-сравнения-тестов)
6. [Тестирование и отладка](#6-тестирование-и-отладка)
7. [Работа с AI-ассистентом](#7-работа-с-ai-ассистентом)
8. [Примеры промптов](#8-примеры-промптов)
9. [Решение проблем](#9-решение-проблем)

---

## 1. Подготовка

### 1.1 Клонирование репозитория

```bash
# Windows (PowerShell)
cd ~\Documents
git clone https://github.com/YOUR_USERNAME/vo2max_report.git
cd vo2max_report

# Ubuntu
cd ~
git clone https://github.com/YOUR_USERNAME/vo2max_report.git
cd vo2max_report
```

### 1.2 Открытие в AI IDE

**Antigravity IDE:**
1. Откройте Antigravity
2. File → Open Folder → выберите папку `vo2max_report`
3. Дождитесь индексации проекта

**Cursor:**
1. Откройте Cursor
2. File → Open Folder → `vo2max_report`
3. Нажмите Ctrl+L для открытия чата

**VS Code + Copilot:**
1. Откройте VS Code
2. Установите расширение GitHub Copilot
3. Откройте папку проекта

### 1.3 Знакомство с проектом

Перед началом адаптации, прочитайте файлы:
- `README.md` — установка и запуск
- `ARCHITECTURE.md` — структура и связи компонентов

**Промпт для AI:**
```
Прочитай файлы README.md и ARCHITECTURE.md и объясни мне структуру этого проекта простыми словами.
```

---

## 2. Описание ваших требований

### 2.1 Что нужно подготовить

Перед общением с AI подготовьте:

1. **Примеры входных данных** — ваши файлы CSV, JSON или другого формата
2. **Образец желаемого отчёта** — скриншот или описание
3. **Список метрик** — какие показатели вам нужны

### 2.2 Как описать формат данных

**Плохо:**
```
У меня есть CSV файл с данными теста.
```

**Хорошо:**
```
У меня есть CSV файл от газоанализатора Cortex MetaMax.
Структура файла:

Строка 1: заголовки
- Time (формат MM:SS)
- VO2 (л/мин)
- VCO2 (л/мин)  
- HR (уд/мин)
- Load (Вт)
- RER

Разделитель: точка с запятой (;)
Десятичный разделитель: запятая (,)

Пример строки:
02:30;2,45;2,12;145;180;0,87

Мне нужно добавить парсер для этого формата.
```

### 2.3 Как описать желаемый отчёт

**Способ 1: Скриншот**
```
Вот скриншот отчёта, который я хочу получить:
[прикрепите изображение]

Создай HTML шаблон, который генерирует такой отчёт.
```

**Способ 2: Текстовое описание**
```
Мне нужен отчёт со следующими секциями:

1. ШАПКА:
   - ФИО спортсмена
   - Дата теста
   - Вид спорта
   - Протокол (старт, шаг, длительность ступени)

2. ТАБЛИЦА ПОРОГОВ:
   - АэП (мощность, ЧСС, лактат)
   - АнП (мощность, ЧСС, лактат)
   - МПК (мощность, ЧСС, VO2max)

3. ГРАФИК:
   - X: мощность
   - Y1: ЧСС (левая ось)
   - Y2: лактат (правая ось)
   - Вертикальные линии для АэП и АнП

4. ТРЕНИРОВОЧНЫЕ ЗОНЫ:
   - Таблица с 5 зонами
   - Мощность от/до
   - ЧСС от/до
   - Описание зоны
```

---

## 3. Добавление нового формата данных

### 3.1 Шаг 1: Покажите пример файла

```
У меня есть файл от газоанализатора [НАЗВАНИЕ].

Вот первые 10 строк файла:
[вставьте содержимое]

Создай парсер для этого формата по образцу csv_parser.py
```

### 3.2 Шаг 2: Попросите создать парсер

**Промпт:**
```
На основе примера файла создай новый парсер:

1. Создай файл backend/core/parsers/metamax_parser.py
2. Класс MetaMaxParser наследует BaseParser
3. Реализуй методы can_parse() и parse()
4. Учти, что разделитель - точка с запятой
5. Учти, что десятичный разделитель - запятая

Посмотри как сделано в csv_parser.py и сделай аналогично.
```

### 3.3 Шаг 3: Зарегистрируйте парсер

**Промпт:**
```
Добавь MetaMaxParser в ParserFactory в файле factory.py,
чтобы он автоматически определялся по расширению файла.
```

### 3.4 Шаг 4: Протестируйте

```
Запусти парсер на моём файле и покажи первые 5 записей:
- время
- VO2
- ЧСС
- мощность
```

---

## 4. Создание нового шаблона отчёта

### 4.1 Шаг 1: Опишите структуру

```
Создай новый шаблон отчёта my_clinic_report.html в папке
backend/core/reports/templates/

Структура отчёта:
1. Логотип клиники (placeholder)
2. Данные пациента (ФИО, возраст, вес, рост)
3. Таблица результатов по ступеням
4. Два графика: VO2 vs мощность и ЧСС vs мощность
5. Заключение (текстовое поле)
6. Подпись врача

Стиль: минималистичный, для печати на A4.
```

### 4.2 Шаг 2: Уточните детали

```
В таблице результатов должны быть колонки:
- Ступень (номер)
- Мощность (Вт)
- VO2 (мл/мин)
- VO2/кг (мл/кг/мин)
- ЧСС (уд/мин)
- Лактат (ммоль/л) — может быть пустым
- RER

Строки с лактатом выше 4.0 выделить жёлтым.
```

### 4.3 Шаг 3: Добавьте графики

```
Для графиков используй Chart.js (уже есть в dashboard.html).
Встрой графики прямо в HTML шаблон как inline скрипты.
```

### 4.4 Шаг 4: Протестируйте

```
Сгенерируй отчёт с моими данными и покажи результат.
Команда: python3 generate_report.py -t my_clinic_report
```

---

## 5. Модификация сравнения тестов

### 5.1 Добавление новой метрики

```
Хочу добавить сравнение по новой метрике — экономичность бега 
(мл O2 на кг на км).

1. Добавь поле в MeasurementItem
2. Рассчитай при парсинге: VO2 / (speed * weight)
3. Добавь в ComparisonService
```

### 5.2 Изменение логики сравнения

```
Сейчас сравнение идёт по мощности.
Хочу добавить режим сравнения по ЧСС:
- Выбираем ЧСС 140, 150, 160, 170, 180
- Для каждой ЧСС находим мощность из разных тестов
- Строим таблицу сравнения
```

---

## 6. Тестирование и отладка

### 6.1 Как запустить тесты

```bash
# Тест парсеров (без Django)
cd backend
python3 test_parsers.py

# Тест генерации отчёта
python3 generate_report.py --list
python3 generate_report.py -t default_report
```

### 6.2 Как добавить логирование

**Промпт:**
```
Добавь подробное логирование в CsvParser:
- Логируй каждую строку при парсинге
- Логируй ошибки преобразования чисел
- Выводи итоговую статистику

Используй стандартный logging Python.
```

**Результат в коде:**
```python
import logging

logging.basicConfig(level=logging.DEBUG)
logger = logging.getLogger(__name__)

class CsvParser(BaseParser):
    def parse(self, file_path):
        logger.info(f"Начинаю парсинг: {file_path}")
        
        for i, row in enumerate(rows):
            logger.debug(f"Строка {i}: {row}")
            try:
                value = float(row['VO2'])
            except ValueError as e:
                logger.error(f"Ошибка в строке {i}: {e}")
        
        logger.info(f"Парсинг завершён: {len(items)} записей")
```

### 6.3 Как отлаживать ошибки

**Шаг 1: Получите текст ошибки**
```bash
python3 test_parsers.py 2>&1 | tee error.log
```

**Шаг 2: Покажите AI**
```
При запуске python3 test_parsers.py получаю ошибку:

[вставьте полный текст ошибки]

Как исправить?
```

### 6.4 Отладка шаг за шагом

**Промпт:**
```
Код падает с ошибкой KeyError: 'VO2'.
Добавь отладочный вывод, чтобы увидеть:
1. Какие ключи есть в словаре
2. Какая строка CSV обрабатывается
3. Какой файл открыт
```

---

## 7. Работа с AI-ассистентом

### 7.1 Основные принципы

1. **Будьте конкретны** — указывайте файлы, строки, функции
2. **Давайте контекст** — показывайте код, ошибки, примеры
3. **Итерируйте** — не пытайтесь сделать всё за один промпт
4. **Проверяйте** — запускайте код после каждого изменения

### 7.2 Структура хорошего промпта

```
КОНТЕКСТ:
Я работаю с проектом vo2max_report.
Файл: backend/core/parsers/csv_parser.py

ТЕКУЩЕЕ ПОВЕДЕНИЕ:
[что происходит сейчас]

ЖЕЛАЕМОЕ ПОВЕДЕНИЕ:
[что должно происходить]

ДОПОЛНИТЕЛЬНО:
[примеры данных, скриншоты, код]
```

### 7.3 Когда показывать скриншоты

- При описании желаемого отчёта
- При показе ошибки в браузере
- При сравнении "было/стало"
- При демонстрации UI

### 7.4 Когда показывать код

- При ошибках — полный traceback
- При модификации — текущий код функции
- При добавлении — примеры аналогичного кода

---

## 8. Примеры промптов

### 8.1 Добавление нового поля в модель

```
Добавь поле 'cadence' (каденс) в модель MeasurementItem:
- Тип: IntegerField
- Может быть null
- Добавь в парсер CSV (колонка RPM)
- Добавь в dashboard.html как новый график
```

### 8.2 Исправление бага

```
Проблема: при парсинге JSON файла поле 'HR' иногда null.

Текущий код (json_parser.py, строка 45):
hr = data['HR']

Ошибка:
TypeError: int() argument must be a string, not NoneType

Исправь так, чтобы null значения обрабатывались корректно.
```

### 8.3 Добавление валидации

```
Добавь валидацию входных данных в CsvParser:

1. Проверка что файл существует
2. Проверка что есть обязательные колонки: Time, VO2, HR
3. Проверка что VO2 > 0 и HR в диапазоне 30-250
4. При ошибке — понятное сообщение с номером строки
```

### 8.4 Рефакторинг

```
Функция parse() в csv_parser.py слишком длинная (150 строк).
Разбей её на:
1. _read_file() — чтение и определение кодировки
2. _parse_headers() — извлечение заголовков
3. _parse_row() — парсинг одной строки
4. _validate() — валидация результата

Сохрани обратную совместимость.
```

### 8.5 Полный цикл адаптации

```
У меня газоанализатор PNOE. 

Шаг 1: Вот пример файла [прикрепить]

Шаг 2: Мне нужен отчёт как на этом скриншоте [прикрепить]

Шаг 3: Порядок работы:
1. Создай парсер для PNOE
2. Создай шаблон отчёта
3. Покажи как сгенерировать отчёт
4. Добавь в README секцию про PNOE

Начни с парсера.
```

---

## 9. Решение проблем

### 9.1 "Не найден модуль"

```
Ошибка: ModuleNotFoundError: No module named 'core'

Решение: Запускайте из папки backend:
cd backend
python3 test_parsers.py
```

### 9.2 "Кодировка файла"

```
Ошибка: UnicodeDecodeError

Решение: Укажите кодировку явно:
with open(path, 'r', encoding='cp1251') as f:
```

### 9.3 "Шаблон не найден"

```
Ошибка: TemplateNotFound: my_report.html

Решение: Проверьте путь:
backend/core/reports/templates/my_report.html
```

### 9.4 "AI не понимает контекст"

```
Проблема: AI предлагает неправильные решения

Решения:
1. Покажите файл ARCHITECTURE.md
2. Укажите конкретные файлы: "посмотри csv_parser.py"
3. Дайте пример: "сделай как в json_parser.py"
```

### 9.5 "Изменения не работают"

**Чеклист:**
1. Сохранили файл?
2. Перезапустили скрипт?
3. Правильный файл редактировали?
4. Синтаксис Python корректный?

**Промпт для проверки:**
```
Я изменил файл csv_parser.py но изменения не применяются.
Вот мой код: [код]
Вот команда запуска: python3 test_parsers.py
Вот вывод: [вывод]

В чём проблема?
```

---

## Чеклист адаптации

- [ ] Клонировал репозиторий
- [ ] Открыл в AI IDE
- [ ] Прочитал README и ARCHITECTURE
- [ ] Подготовил примеры своих данных
- [ ] Описал желаемый результат
- [ ] Создал парсер (если нужен)
- [ ] Создал шаблон отчёта
- [ ] Протестировал на своих данных
- [ ] Исправил ошибки
- [ ] Задокументировал изменения

---

## Полезные команды

```bash
# Список файлов проекта
find backend -name "*.py" | head -20

# Поиск в коде
grep -r "VO2" backend/

# Проверка синтаксиса Python
python3 -m py_compile backend/core/parsers/csv_parser.py

# Запуск с отладкой
python3 -u test_parsers.py 2>&1 | tee debug.log
```

---

## Контакты и помощь

Если что-то не работает:

1. Скопируйте этот файл ADAPTATION.md
2. Вставьте в ChatGPT / Claude
3. Опишите вашу проблему
4. Приложите текст ошибки

AI поможет разобраться на основе этой документации.
